parameters:
  paste.ttl: 604800
  redis.scheme: 'tcp'
  redis.host: 'localhost'
  redis.port: 6379

framework:
  secret: '%env(SECRET)%'
  http_method_override: true
  router:
    resource: '%kernel.root_dir%/../cfg/routing.prod.yml'
    strict_requirements: '%kernel.debug%'
  templating:
    engines: ['twig']
  session:
    cookie_secure: true

monolog:
  handlers:
    main:
      type: 'fingers_crossed'
      action_level: 'notice'
      handler: 'nested'
    nested:
      type: 'stream'
      path: '%kernel.logs_dir%/%kernel.name%.log'
      level: 'debug'

twig:
  debug: '%kernel.debug%'
  strict_variables: '%kernel.debug%'

services:

  predis.client:
    class: 'Predis\Client'
    arguments:
      -
        scheme: '%redis.scheme%'
        host: '%redis.host%'
        port: '%redis.port%'

  paste.cache:
    class: 'Doctrine\Common\Cache\PredisCache'
    arguments: [ '@predis.client' ]
  paste.hash_generator:
    class: 'AppBundle\Security\HashGenerator'
    arguments: [ '%kernel.secret%' ]
  paste.repository:
    class: 'AppBundle\Repository\PasteRepository'
    arguments: [ '@paste.cache', '%paste.ttl%' ]

  paste.controller.index:
    class: 'AppBundle\Controller\IndexController'
    arguments: [ '@templating', '@router' ]
  paste.controller.create:
    class: 'AppBundle\Controller\CreateController'
    arguments: [ '@templating', '@router', '@paste.repository' ]
  paste.controller.read:
    class: 'AppBundle\Controller\ReadController'
    arguments: [ '@templating', '@router', '@paste.repository' ]
  paste.controller.update:
    class: 'AppBundle\Controller\UpdateController'
    arguments: [ '@paste.repository' ]
  paste.controller.delete:
    class: 'AppBundle\Controller\DeleteController'
    arguments: [ '@paste.repository' ]

  paste.kernel.exception_listener:
    class: 'AppBundle\EventListener\ExceptionListener'
    arguments: [ '@logger' ]
    tags:
      - { name: 'kernel.event_listener', event: 'kernel.exception', method: 'handleEvent' }
  paste.kernel.request_listener:
    class: 'AppBundle\EventListener\RequestListener'
    arguments: [ '@paste.hash_generator' ]
    tags:
      - { name: 'kernel.event_listener', event: 'kernel.request', method: 'handleEvent' }
  paste.kernel.response_listener:
    class: 'AppBundle\EventListener\ResponseListener'
    arguments: [ '@paste.hash_generator' ]
    tags:
      - { name: 'kernel.event_listener', event: 'kernel.response', method: 'handleEvent' }

  paste.command.read:
    class: 'AppBundle\Console\Command\ReadCommand'
    arguments: [ '@paste.repository' ]
    tags:
      - { name: 'console.command' }
  paste.command.delete:
    class: 'AppBundle\Console\Command\DeleteCommand'
    arguments: [ '@paste.repository' ]
    tags:
      - { name: 'console.command' }
